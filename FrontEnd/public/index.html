<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <link rel="icon" type="image/png" href="/icon.PNG">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <meta
    name="description"
    content="Web site created using create-react-app"
  />
  <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
  <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
  <title>포카포미</title>

</head>
<body>
  <div id="root"></div>

  <!-- Firebase SDK 로드 -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-messaging.js"></script>

  <script>
    // Firebase 구성 정보
    const firebaseConfig = {
      apiKey: "AIzaSyD-iDPmb0MyrFHqdEKVdaFs9V9vT4Rc-2w",
      authDomain: "phocaforme.firebaseapp.com",
      projectId: "phocaforme",
      storageBucket: "phocaforme.appspot.com",
      messagingSenderId: "250202437051",
      appId: "1:250202437051:web:14ab6bb0445aad9b08009e",
      measurementId: "G-9EZG3PJXLT"
    };

    // Firebase 초기화
    firebase.initializeApp(firebaseConfig);

    // 서비스 워커 등록
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        const registration = await navigator.serviceWorker.register('/firebase-messaging-sw.js');
        console.log('서비스 워커 등록 성공:', registration);
      });
    }

    // 알림 권한 요청
    function requestNotificationPermission() {
      Notification.requestPermission().then((permission) => {
        if (permission === 'granted') {
          console.log('Notification permission granted.');
          // 알림 권한이 부여되면 푸시 토큰을 가져올 수 있도록 요청
          messaging.getToken().then((token) => {
            console.log('푸시 토큰:', token);
            // 푸시 토큰을 서버로 전송하여 푸시 알림을 보낼 수 있도록 함
            // 서버로 전송하는 코드를 여기에 추가
            sendTokenToServer(token);
          }).catch((error) => {
            console.log('푸시 토큰을 가져오는 중에 오류 발생:', error);
          });
        } else {
          console.log('Notification permission denied.');
        }
      });
    }

    // 푸시 알림 토큰을 서버로 전송하는 함수
    function sendTokenToServer(token) {
      fetch('/api/store-token', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ token: token }),
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('서버 응답이 실패했습니다.');
        }
        console.log('푸시 토큰을 서버로 전송했습니다.');
      })
      .catch(error => {
        console.error('푸시 토큰을 서버로 전송하는 중 오류 발생:', error);
      });
    }

    // 페이지 로드 시 알림 권한 요청
    window.onload = function() {
      requestNotificationPermission();
    };
  </script>
</body>
</html>
